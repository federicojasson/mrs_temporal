package modules;

import java.nio.charset.Charset;
import java.security.MessageDigest;
import java.security.NoSuchAlgorithmException;
import java.util.Arrays;
import utility.Utility;
import entities.AuthenticationData;

public class SecurityManager {
	
	public static boolean authenticateUser(AuthenticationData authenticationData, String plaintextPassword) {
		// Computes the hash of the plaintext password using the salt as its prefix
		byte[] password = hashPassword(plaintextPassword, authenticationData.getSalt());
		
		// Compares the hashes
		return Arrays.equals(authenticationData.getPassword(), password);
	}
	
	private static byte[] hashPassword(byte[] plaintextPassword, byte[] salt) {
		try {
			// Initializes the algorithm
			MessageDigest algorithm = MessageDigest.getInstance("SHA-512");
			
			// Concatenates bytes
			byte[] plaintextPasswordBytes = plaintextPassword.getBytes(Charset.forName("UTF-8"));
			int byteCount = salt.length + plaintextPasswordBytes.length;
			byte[] bytes = new byte[byteCount];
			
			byte[] bytes = new byte[salt.length + b.length];
			System.arraycopy(salt, 0, bytes, 0, salt.length);
			System.arraycopy(b, 0, bytes, salt.length, b.length);
			
			
			// Hashes the plaintext password
			return algorithm.digest(bytes);
		} catch (NoSuchAlgorithmException exception) {
			// Exits the application abnormally
			ApplicationManager.exitAbnormally("Algorithm SHA-512 not found.", exception);
			return null;
		}
	}
	
}
