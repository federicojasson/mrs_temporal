package modules;

import java.io.File;

public class PatientManager {
	
	public static void addPatient() {
		// Generates a study ID
		byte[] id = CryptographyManager.generateRandomUuid();
		
		// Copies the files to the system directory tree
		for (File studyFile : studyFiles)
			FileManager.copyStudyFile(id, studyFile);
		
		// Starts a transaction
		DatabaseManager.startTransaction();
		
		// Inserts the study into the database
		DatabaseManager.insertStudy(date, id, observations, patientId, studyTypeId);
		
		// Inserts the study files into the database
		for (File studyFile : studyFiles) {
			byte[] checksum = CryptographyManager.computeFileChecksum(studyFile);
			String filename = studyFile.getName();
			DatabaseManager.insertStudyFile(checksum, filename, id);
		}
		
		// Commits the transaction
		DatabaseManager.commitTransaction();
	}
	
}
